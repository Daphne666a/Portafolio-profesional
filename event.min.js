// Manejo del formulario de contacto (versión legible)
document.addEventListener("DOMContentLoaded", function () {
    const formId = "contactForm";
    const form = document.getElementById(formId);

    if (!form) {
        console.error("No se encontró el formulario con ID:", formId);
        return;
    }

    form.addEventListener("submit", function (event) {
        // Prevenir recarga de página
        event.preventDefault();
        event.stopPropagation();

        const nombre = form.nombre?.value || "";
        const email = form.email?.value || "";
        const mensaje = form.mensaje?.value || "";

        if (!nombre || !email || !mensaje) {
            alert("Por favor completa todos los campos");
            return;
        }

        const payload = {
            nombre: nombre,
            email: email,
            mensaje: mensaje
        };

        const hostname = window.location.hostname;
        const isLocalhost = hostname === "localhost" || hostname === "127.0.0.1";
        const apiUrl = isLocalhost ? "http://localhost:3000/api/contact" : "/api/contact";

        fetch(apiUrl, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        })
            .then(function (response) {
                if (!response.ok) {
                    throw new Error("Error en la respuesta del servidor");
                }
                return response.json();
            })
            .then(function (data) {
                if (data && data.success) {
                    alert("Mensaje enviado correctamente");
                    form.reset();
                } else {
                    alert("Error: " + (data?.error || "Desconocido"));
                }
            })
            .catch(function (error) {
                console.error("Error en el envío:", error);
                alert("Error de conexión: " + error.message);
            });
    });
});
