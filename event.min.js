// Script para manejar el envío del formulario de contacto
document.addEventListener("DOMContentLoaded", function() {
    console.log("DOM completamente cargado");
    
    // Obtener el formulario por su ID exacto
    const form = document.getElementById("contactForm");
    
    // Verificar que el formulario existe
    if (!form) {
        console.error("ERROR: No se encontró el formulario con ID 'contactForm'");
        return;
    }
    
    console.log("Formulario encontrado correctamente");
    
    // Manejar el evento de envío del formulario
    form.addEventListener("submit", function(evento) {
        // IMPORTANTE: Prevenir el comportamiento por defecto PRIMERO
        evento.preventDefault();
        evento.stopPropagation();
        
        console.log("Envío del formulario interceptado correctamente");
        
        // Obtener los valores del formulario
        const nombre = form.nombre.value;
        const email = form.email.value;
        const mensaje = form.mensaje.value;
        
        console.log("Datos del formulario:", { nombre, email, mensaje });
        
        // Validación básica
        if (!nombre || !email || !mensaje) {
            alert("Por favor completa todos los campos");
            return;
        }
        
        // Preparar los datos para enviar
        const datosFormulario = {
            nombre: nombre,
            email: email,
            mensaje: mensaje
        };
        
        // Determinar la URL de la API según el entorno
        const esLocalhost = window.location.hostname === "localhost";
        const urlApi = esLocalhost ? "http://localhost:3000/api/contact" : "/api/contact";
        
        console.log("Enviando a:", urlApi);
        
        // Enviar los datos usando fetch
        fetch(urlApi, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(datosFormulario)
        })
        .then(function(respuesta) {
            console.log("Respuesta recibida. Status:", respuesta.status);
            
            if (!respuesta.ok) {
                throw new Error("Error en la respuesta del servidor");
            }
            
            return respuesta.json();
        })
        .then(function(datos) {
            console.log("Datos procesados:", datos);
            
            if (datos.success) {
                alert("¡Mensaje enviado correctamente!");
                form.reset();
            } else {
                alert("Error al enviar: " + (datos.error || "Error desconocido"));
            }
        })
        .catch(function(error) {
            console.error("Error en el envío:", error);
            alert("Error de conexión: " + error.message);
        });
    });
    
    console.log("Event listener del formulario registrado correctamente");
});
